{"version":3,"sources":["pictures-test.js"],"names":["beforeEach","t","srv","context","url","image","getImage","body","uri","publicId","json","deepEqual","options","method","description","src","userId","resolveWithFullResponse","response","is","statusCode","id","imageNew","JSON","parse","stringify","liked","likes","images","getImages"],"mappings":"AAAA;;AAEA;;;;AACA;;;;AAIA;;;;AAMA;;;;AACA;;;;AACA;;;;;;;AAXA;;;;AAIA;;;;;;;AASA,cAAKA,UAAL;AAAA,+BAAgB,WAAMC,CAAN,EAAW;AACzB,QAAIC,MAAM,wCAAV;AACAD,MAAEE,OAAF,CAAUC,GAAV,GAAgB,MAAM,0BAAOF,GAAP,CAAtB;AACD,GAHD;;AAAA;AAAA;AAAA;AAAA;;AAKA,mBAAK,UAAL;AAAA,gCAAiB,WAAMD,CAAN,EAAW;AAC1B,QAAII,QAAQ,mBAASC,QAAT,EAAZ;AACA,QAAIF,MAAMH,EAAEE,OAAF,CAAUC,GAApB;AACA,QAAIG,OAAO,MAAM,8BAAQ,EAAEC,KAAM,GAAEJ,GAAI,IAAGC,MAAMI,QAAS,EAAhC,EAAmCC,MAAM,IAAzC,EAAR,CAAjB;AACAT,MAAEU,SAAF,CAAYJ,IAAZ,EAAkBF,KAAlB;AACD,GALD;;AAAA;AAAA;AAAA;AAAA;;AAOA;;;AAGA,mBAAK,QAAL;AAAA,gCAAe,WAAMJ,CAAN,EAAW;AACxB,QAAII,QAAQ,mBAASC,QAAT,EAAZ;AACA,QAAIF,MAAMH,EAAEE,OAAF,CAAUC,GAApB;;AAEA;;;;;AAKA,QAAIQ,UAAU;AACZC,cAAQ,MADI;AAEZL,WAAKJ,GAFO;AAGZM,YAAM,IAHM;AAIZH,YAAM;AACJO,qBAAaT,MAAMS,WADf;AAEJC,aAAKV,MAAMU,GAFP;AAGJC,gBAAQX,MAAMW;AAHV,OAJM;AASZC,+BAAyB;AATb,KAAd;;AAYA,QAAIC,WAAW,MAAM,8BAAQN,OAAR,CAArB;;AAEAX,MAAEkB,EAAF,CAAKD,SAASE,UAAd,EAA0B,GAA1B;AACAnB,MAAEU,SAAF,CAAYO,SAASX,IAArB,EAA2BF,KAA3B;AACD,GAzBD;;AAAA;AAAA;AAAA;AAAA;;AA2BA,mBAAK,gBAAL;AAAA,gCAAuB,WAAMJ,CAAN,EAAW;AAChC,QAAII,QAAQ,mBAASC,QAAT,EAAZ;AACA,QAAIF,MAAMH,EAAEE,OAAF,CAAUC,GAApB;;AAEA,QAAIQ,UAAU;AACZC,cAAQ,MADI;AAEZL,WAAM,GAAEJ,GAAI,IAAGC,MAAMgB,EAAG,OAFZ;AAGZX,YAAM;AAHM,KAAd;;AAMA,QAAIH,OAAO,MAAM,8BAAQK,OAAR,CAAjB;AACA;AACA,QAAIU,WAAWC,KAAKC,KAAL,CAAWD,KAAKE,SAAL,CAAepB,KAAf,CAAX,CAAf;AACAiB,aAASI,KAAT,GAAiB,IAAjB;AACAJ,aAASK,KAAT,GAAiB,CAAjB;;AAEA1B,MAAEU,SAAF,CAAYJ,IAAZ,EAAkBe,QAAlB;AACD,GAjBD;;AAAA;AAAA;AAAA;AAAA;;AAmBA,mBAAK,WAAL;AAAA,gCAAkB,WAAMrB,CAAN,EAAW;AAC3B,QAAI2B,SAAS,mBAASC,SAAT,EAAb;AACA,QAAIzB,MAAMH,EAAEE,OAAF,CAAUC,GAApB;;AAEA,QAAIQ,UAAU;AACZC,cAAQ,KADI;AAEZL,WAAM,GAAEJ,GAAI,OAFA;AAGZM,YAAM;AAHM,KAAd;;AAMA,QAAIH,OAAO,MAAM,8BAAQK,OAAR,CAAjB;;AAEAX,MAAEU,SAAF,CAAYJ,IAAZ,EAAkBqB,MAAlB;AACD,GAbD;;AAAA;AAAA;AAAA;AAAA","file":"pictures-test.js","sourcesContent":["'use strict'\r\n\r\nimport test from 'ava'\r\nimport micro from 'micro'\r\n/**\r\n * permite hacer testing en microservicios con micro\r\n */\r\nimport listen from 'test-listen'\r\n/**\r\n * permite usar http pero con promesas\r\n * funciona igual que el modulo request\r\n * solo que implementa promises\r\n */\r\nimport request from 'request-promise'\r\nimport fixtures from './fixtures/'\r\nimport pictures from '../pictures'\r\n\r\ntest.beforeEach(async t => {\r\n  let srv = micro(pictures)\r\n  t.context.url = await listen(srv)\r\n})\r\n\r\ntest('Get /:id', async t => {\r\n  let image = fixtures.getImage()\r\n  let url = t.context.url\r\n  let body = await request({ uri: `${url}/${image.publicId}`, json: true })\r\n  t.deepEqual(body, image)\r\n})\r\n\r\n/**\r\n * Guardar imagen\r\n */\r\ntest('POST /', async t => {\r\n  let image = fixtures.getImage()\r\n  let url = t.context.url\r\n\r\n  /**\r\n   * resolveWithfullResponse: true\r\n   * resover la respuesta completa y retornar un response en vez\r\n   * de solo el body\r\n   */\r\n  let options = {\r\n    method: 'POST',\r\n    uri: url,\r\n    json: true,\r\n    body: {\r\n      description: image.description,\r\n      src: image.src,\r\n      userId: image.userId\r\n    },\r\n    resolveWithFullResponse: true\r\n  }\r\n\r\n  let response = await request(options)\r\n\r\n  t.is(response.statusCode, 201)\r\n  t.deepEqual(response.body, image)\r\n})\r\n\r\ntest('POST /:id/like', async t => {\r\n  let image = fixtures.getImage()\r\n  let url = t.context.url\r\n\r\n  let options = {\r\n    method: 'POST',\r\n    uri: `${url}/${image.id}/like`,\r\n    json: true\r\n  }\r\n\r\n  let body = await request(options)\r\n  /** Clonar un objeto pequeÃ±o */\r\n  let imageNew = JSON.parse(JSON.stringify(image))\r\n  imageNew.liked = true\r\n  imageNew.likes = 1\r\n\r\n  t.deepEqual(body, imageNew)\r\n})\r\n\r\ntest('GET /list', async t => {\r\n  let images = fixtures.getImages()\r\n  let url = t.context.url\r\n\r\n  let options = {\r\n    method: 'GET',\r\n    uri: `${url}/list`,\r\n    json: true\r\n  }\r\n\r\n  let body = await request(options)\r\n\r\n  t.deepEqual(body, images)\r\n})\r\n"]}